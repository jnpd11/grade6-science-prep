---
import Base from '../../layouts/Base.astro';
import { getCollection, render } from 'astro:content';
import ThemeControls from '../../components/ThemeControls.astro';
import UnitHero from '../../components/UnitHero.astro';

export async function getStaticPaths() {
  const lessons = await getCollection('lessons');
  return lessons.map((entry) => ({ params: { slug: entry.slug }, props: { entry } }));
}

const { entry } = Astro.props;
const { Content, headings } = await render(entry);

const title = `${entry.data.title} Â· å…­å¹´çº§ä¸‹ç§‘å­¦é¢„ä¹ `;
---

<Base title={title} description={entry.data.summary}>
  <Fragment slot="controls"><ThemeControls /></Fragment>
  <article class="hero">
    <div class="no-print" style="display:flex; gap:10px; flex-wrap:wrap; justify-content:space-between; align-items:flex-start">
      <div>
        <div class="unitTag" style="margin-bottom:10px"><i aria-hidden="true"></i>{entry.data.unit ?? 'è¯¾ç¨‹'}</div>
        <h1 style="margin-bottom:6px">{entry.data.title}</h1>
        <p class="sub" style="margin:0">{entry.data.minutes ? `å»ºè®® ${entry.data.minutes} åˆ†é’Ÿ` : ''}</p>
      </div>
      {entry.data.image ? (
        <div class="lesson-image no-print" style="margin-top:12px">
          <img 
            src={entry.data.image} 
            alt={entry.data.title}
            loading="lazy"
            style="width:100%; max-height:180px; object-fit:cover; border-radius:12px; border:1px solid var(--border);"
          />
        </div>
      ) : null}
      <div style="display:flex; gap:10px; flex-wrap:wrap">
        <a class="btn" href="/lessons">â† è¿”å›ç›®å½•</a>
        <button class="btn" onclick="window.print()">ğŸ–¨ï¸ æ‰“å°è¿™ä¸€è¯¾</button>
      </div>
    </div>

    <div style="margin-top:12px" class="no-print"><UnitHero unit={entry.data.unit ?? 'è¯¾ç¨‹'} /></div>

    <hr style="border:0;border-top:1px solid var(--border);margin:14px 0" />

    <div style="display:grid; grid-template-columns: 1fr; gap: 14px;">
      <div class="item" style="background: rgba(17,26,51,.35)">
        <Content />
      </div>

      <div class="item no-print">
        <div style="display:flex; align-items:center; justify-content:space-between; gap:12px">
          <b>å¿«é€Ÿè‡ªæµ‹ï¼ˆç‚¹ä¸€ä¸‹çœ‹ç­”æ¡ˆï¼‰</b>
          <small>ç›®æ ‡ï¼šå¸¦ç€ 2â€“3 ä¸ªé—®é¢˜è¿›è¯¾å ‚</small>
        </div>
        <details style="margin-top:10px">
          <summary style="cursor:pointer">æˆ‘èƒ½ç”¨ä¸€å¥è¯è¯´æ¸…è¿™è¯¾åœ¨å­¦ä»€ä¹ˆå—ï¼Ÿ</summary>
          <div class="itemDesc">è¯•ç€ç”¨â€œæˆ‘ä»¬è¦æµ‹å®š ___ï¼Œå¹¶ç”¨ ___ æ–¹æ³•ï¼Œè®©ç»“æœæ›´ ___ã€‚â€æ¥é€ å¥ã€‚</div>
        </details>
        <details style="margin-top:10px">
          <summary style="cursor:pointer">æˆ‘èƒ½è¯´å‡º 3 ä¸ªå…³é”®è¯å¹¶è§£é‡Šå—ï¼Ÿ</summary>
          <div class="itemDesc">å¦‚æœè§£é‡Šä¸å‡ºæ¥ï¼Œå°±å›åˆ°â€œå…³é”®è¯å°å¡ç‰‡â€é‚£ä¸€æ®µã€‚</div>
        </details>
      </div>

      {headings?.length ? (
        <div class="item no-print">
          <b>æœ¬é¡µç›®å½•</b>
          <div style="margin-top:8px;display:flex;gap:10px;flex-wrap:wrap">
            {headings
              .filter((h) => h.depth <= 2)
              .map((h) => (
                <a class="k" href={`#${h.slug}`}>{h.text}</a>
              ))}
          </div>
        </div>
      ) : null}
    </div>
  </article>
</Base>
